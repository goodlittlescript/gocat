#!/bin/bash
# usage: ./Projectfile [command]
export PACKAGE=goodlittlescript.com/gocat

#
# workflow
#

images () {
  docker-compose build --compress --parallel
}

up () {
  docker-compose up --detach
}

shell () {
  docker-compose exec shell /bin/bash
}

down () {
  docker-compose stop
}

show () {
  docker-compose ps
}

logs () {
  docker-compose logs -f
}

lint () {
  _run gofmt -s -e -d .
}

fix () {
  _run gofmt -s -w .
}

test () {
  _run ./test/suite
}


#
# utility
#

_run () {
  if command -v docker-compose >/dev/null 2>&1
  then docker-compose run --rm shell "$@"
  else "$@"
  fi
}

list () {
  compgen -A function
}

while [ $# -gt 0 ]
do
  command="$1"; shift 1
  if list | grep -qFx "$command"
  then "$command"
  else
    printf "unknown command: %s\n" "$command" >&2
    exit 1
  fi
done
